#include "Menu.h"
#include "ADCTestMain.h"
#include "ST7735.h"

extern volatile uint32_t TimeSecs;
extern volatile uint16_t SW3;
extern volatile uint16_t SW2;
extern volatile uint16_t SW1;
extern volatile uint16_t SW0;

const unsigned short arrow[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x2E9F, 0x2E9F, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x2E9F, 0x2E9F,
 0x369F, 0x2E9F, 0x2E9F, 0x2E9F, 0x0000, 0x0000, 0x0000, 0x0000, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F,
 0x0000, 0x0000, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x0000, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F,
 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x0000, 0x0000, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x0000, 0x0000, 0x0000, 0x0000,
 0x2E9F, 0x2E9F, 0x2E9F, 0x2E9F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x2E9F, 0x2E9F, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};
const unsigned short arrowclean[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,

};


uint16_t pos = 3;

void Refresh_Menu(void){
  uint32_t time = TimeSecs;
  uint16_t hrs = time/3600;
  uint16_t mins = (time%3600)/60;
  uint16_t meridiem = 0;
  if(hrs >= 12){
    meridiem = 15;
    hrs -= 12;
  }
  if(!hrs){
    hrs = 12;
  }
  ST7735_SetCursor(0, 0);
  ST7735_OutChar(hrs/10 + '0');
  ST7735_OutChar(hrs%10 + '0');
  ST7735_OutChar(':');
  ST7735_OutChar(mins/10 + '0');
  ST7735_OutChar(mins%10 + '0');
  ST7735_OutChar('a' + meridiem);
  ST7735_OutChar('m');
  if(SW3 | SW2 | SW1 | SW0){
    if(SW3){          // enter
      switch(pos){
        case 3:       // display digital clock
          break;
        case 2:       // display analog clock
          break;
        case 1:       // set alarm
          break;
        case 0:       // set clock
          break;
      }
    }
    else if(SW2){     // up
      ST7735_DrawBitmap(5, 138 - pos*10, arrowclean, 10, 11);
      pos = (pos+1)%4;
      ST7735_DrawBitmap(5, 138 - pos*10, arrow, 10, 11);
    }
    else if(SW1){     // down
      ST7735_DrawBitmap(5, 138 - pos*10, arrowclean, 10, 11);
      if(pos){
        pos = pos-1;
      }
      ST7735_DrawBitmap(5, 138 - pos*10, arrow, 10, 11);
    }
    else{             // reserved
    }
    SW3 = SW2 = SW1 = SW0 = 0;
  }
}

void Draw_Menu(void){
  Refresh_Menu();
  ST7735_SetCursor(3, 10);
  ST7735_OutString("Digital Clock");
  ST7735_SetCursor(3, 11);
  ST7735_OutString("Analog Clock");
  ST7735_SetCursor(3, 12);
  ST7735_OutString("Set Alarm");
  ST7735_SetCursor(3, 13);
  ST7735_OutString("Set Clock");
  ST7735_DrawBitmap(5, 108, arrow, 10, 11);
}

